<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>HealthApp - Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-light">
    <div class="container py-5">
      <div id="root"></div>
    </div>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <script type="text/babel">
      const { useState } = React;

      function App(){
        const [form, setForm] = useState({first_name:'', last_name:'', age:'', height_cm:'', weight_kg:'', notes:''});
        const [status, setStatus] = useState(null);

        function change(e){
          const {name, value} = e.target;
          setForm(prev => ({...prev, [name]: value}));
        }

        async function submit(e){
          e.preventDefault();
          setStatus('saving');
          try{
            const res = await fetch('/api/profile/', {
              method: 'POST',
              headers: {'Content-Type': 'application/json'},
              body: JSON.stringify({
                ...form,
                age: form.age ? Number(form.age) : null,
                height_cm: form.height_cm ? Number(form.height_cm) : null,
                weight_kg: form.weight_kg ? Number(form.weight_kg) : null,
              })
            });
            const data = await res.json();
            if(data.ok){
              setStatus('saved');
              setForm({first_name:'', last_name:'', age:'', height_cm:'', weight_kg:'', notes:''}); //reset form after submitting
            } else {
              setStatus('error');
            }
          } catch(err){
            setStatus('error');
          }
        }

        return (
          <div className="card shadow-sm">
            <div className="card-body">
              <h3 className="card-title mb-3">Health Profile</h3>
              <form onSubmit={submit}>
                <div className="row">
                  <div className="col-md-6 mb-3">
                    <label className="form-label">First name</label>
                    <input name="first_name" value={form.first_name} onChange={change} className="form-control" required />
                  </div>
                  <div className="col-md-6 mb-3">
                    <label className="form-label">Last name</label>
                    <input name="last_name" value={form.last_name} onChange={change} className="form-control" />
                  </div>
                </div>

                <div className="row">
                  <div className="col-md-4 mb-3">
                    <label className="form-label">Age</label>
                    <input name="age" value={form.age} onChange={change} className="form-control" type="number" min="0" />
                  </div>
                  <div className="col-md-4 mb-3">
                    <label className="form-label">Height (cm)</label>
                    <input name="height_cm" value={form.height_cm} onChange={change} className="form-control" type="number" step="0.1" />
                  </div>
                  <div className="col-md-4 mb-3">
                    <label className="form-label">Weight (kg)</label>
                    <input name="weight_kg" value={form.weight_kg} onChange={change} className="form-control" type="number" step="0.1" />
                  </div>
                </div>

                <div className="mb-3">
                  <label className="form-label">Notes</label>
                  <textarea name="notes" value={form.notes} onChange={change} className="form-control" rows="3"></textarea>
                </div>

                <div className="d-flex align-items-center">
                  <button className="btn btn-primary me-3" type="submit">Save</button>
                  {status === 'saving' && <span className="text-muted">Saving...</span>}
                  {status === 'saved' && <span className="text-success">Saved!</span>}
                  {status === 'error' && <span className="text-danger">Error saving</span>}
                </div>
              </form>
            </div>
          </div>
        )
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);

    </script>
  </body>
</html>
